<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic Page</title>
    <link rel="stylesheet" href="styles.css">

    <script type="module">
        import { getBotResponse } from './eliza.js';

        const DEBUG = false;
        const log = (msg) => { if (DEBUG) console.log(msg); };
      

        function showResponse(response) {
            addToChatWindow(response, 'bot');
        }

        function getResponse(message) {
            return getBotResponse(message);
        }

        function processMessage(message) {
            let response = getResponse(message);

            showResponse(response);
        }


        function addToChatWindow(message, speaker) {
            let chatWindow = document.getElementById('chat-window');
            const timeStamp = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

            const isUser = speaker === 'user';
            const avatar = isUser ? 'ðŸ‘¤' : 'ðŸ¤–'; // Use Profile if isUser is true, else use Robot

            chatWindow.innerHTML += `
                <div class="message ${isUser ? 'user-message' : 'bot-message'}">
                    <div class="message-header">
                        <span class="avatar">${avatar}</span>
                        <span class="timestamp">${timeStamp}</span>
                    </div>
                    <div class="message-content">
                        <p>${message}</p>
                    </div>
                </div>
            `;

            // Force scrolls to bottom after messages are added
            chatWindow.scrollTop = chatWindow.scrollHeight;
        }


        function send() {
            let messageBox = document.getElementById('message-box');
            let message = messageBox.value;

            let chatWindow = document.getElementById('chat-window');
            
            messageBox.value = ''; // clear the field
            messageBox.focus();

            addToChatWindow(message,'user');

            processMessage(message);
        }


        function init() {
            log('Initializing chat interface');
            document.getElementById('send-button').addEventListener('click', function () {
                event.preventDefault();   
                send();
            });
            document.getElementById('message-box').addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();   
                    send();
                }
            });
        }
        
        window.addEventListener('DOMContentLoaded', init);
    </script>
</head>

<body>
    <!-- Might wrap header, main and chat-footer in one container to easily style -->
    <header id="chat-header">
        <h1>Chat Assistant</h1>
        <p>Prototype: Pure HTML and CSS</p>
    </header>

    <main>
        <section id="chat-window" class="message-history">

        </section>
        <form id="chat-input-area">
            <input id="message-box" type="text" placeholder="Type your message...">
            <button id="send-button" type="button">Send</button>
        </form>
    </main>

    <chat-footer>
        <p>&#8505; This is a dom example.</p>
    </chat-footer>
</body>

</html>